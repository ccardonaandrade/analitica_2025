---
title: Anal√≠tica de los Negocios
author: Carlos Cardona Andrade
subtitle: Explorando datos num√©ricos
execute:
  freeze: auto
  echo: true
  fig-width: 6
  fig-height: 5
format:
  revealjs: 
   theme: ../slides.scss
   header-includes: |
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet"/>
   slide-number: true
   show-slide-number: all
   transition: fade
   progress: true
   multiplex: false
   scrollable: false
   preview-links: false
   hide-inactive-cursor: true
   highlight-style: printing
   pause: true
---
     
```{r}
#| eval: true
#| echo: false
library(knitr)
library(forcats)
library(patchwork)
library(lubridate)
library(cowplot)
library(tidyverse)
library(kableExtra)
library(openintro)
library(janitor)
library(ggrepel)
library(scales)

```


## Plan para hoy

1. [Estructura de un proyecto](#project)

2. [Fundamentos sobre los datos](#data)

3. [El Histograma](#histograma)

4. [Medidas de tendencia central](#central)

5. [Diagrama de caja](#boxplot)

6. [Medidas de dispersi√≥n](#dispersion)

7. [Medidas de relaci√≥n entre dos variables](#bivariado)


# Estructura de un proyecto {#project}

## Estructura de un proyecto {.medium}

Un proyecto deber√≠a tener la siguiente estructura para facilitar la organizaci√≥n:

```
üìÇ project_name
‚îú‚îÄ‚îÄ üìÇ data
‚îú‚îÄ‚îÄ üìÇ scripts
‚îî‚îÄ‚îÄ üìÇ output
    ‚îú‚îÄ‚îÄ üìÇ plots
    ‚îî‚îÄ‚îÄ üìÇ data
```

. . .

- Esta organizaci√≥n facilita el trabajo colaborativo y ayuda a retomar el proyecto m√°s f√°cilmente

- Eviten usar **may√∫sculas** o **espacios** en los nombres de archivos y carpetas. Ejemplos:
    - Incorrecto: `Archivo de datos.csv`
    - Correcto: `archivo_de_datos.csv`


## El Directorio de Trabajo {.medium}

- El directorio de trabajo es la carpeta en la que est√°n trabajando actualmente

- <i class="fa-brands fa-r-project"></i> guarda y carga archivos desde esta carpeta por defecto

- Antes de comenzar, aseg√∫rense de establecer tu directorio de trabajo con la siguiente funci√≥n:

```{r}
#| eval: false
setwd("C:/Users/nombre_apellido/OneDrive/Documentos/analisis_de_datos/")
```

. . .

- Recuerden que en el explorador de archivos, las carpetas se dividen por "`\`", pero <i class="fa-brands fa-r-project"></i> requiere "`/`" como separador de carpetas

::: {.aside}
Para entender por qu√© el uso de "`/`" pueden leer [Forward Slash in R](https://www.geeksforgeeks.org/how-to-convert-backslash-to-forward-slash-in-r/){target="_blank"}
:::

## Establecer el Directorio de Trabajo Manualmente {.medium}

Tambi√©n puedes hacerlo manualmente desde el visualizador de archivos en R Studio:

Primero, van al panel [Files] en la parte inferior derecha.


![](img/paso1.png){fig-align="center" width=80%}



## Establecer el Directorio de Trabajo Manualmente {.medium}


Luego en la parte derecha, hagan clic en `...` que es ‚ÄúGo to directory‚Äù.


![](img/paso2.png){fig-align="center" width=80%}



## Establecer el Directorio de Trabajo Manualmente {.medium}


Seleccionen la carpeta donde van a tener sus archivos. El directorio deber√° aparecer en [Files].

![](img/paso3.png){fig-align="center" width=80%}


## Establecer el Directorio de Trabajo Manualmente {.medium}


Seleccionen la tuerca en [FILES] y establezcan la carpeta como directorio de trabajo.


![](img/paso4.png){fig-align="center" width=80%}

## üí™ Ejercicio 1  {.medium}

1. Usando la plantilla con la que ya hemos trabajado anteriormente, establezcan el directorio de trabajo (la carpeta donde guardaron los datos de airbnb):

```{r}
#| eval: false
# Ejemplo:
setwd("C:\Users\ccard\Downloads")
```

. . .

2. Carguen los datos `airbnb_ny_2019` de la siguiente manera usando el paquete `tidyverse`:

```{r}
#| eval: false
airbnb <- read.csv("airbnb_ny_2019.csv")
```

3. Exploren los datos usando la funci√≥n `glimpse()` 

# Fundamentos sobre los datos {#data}

## Tipos de variables

```{r}
#| echo: false
#| fig-align: center

par_og <- par(no.readonly = TRUE) # save original par
par(mar = rep(0, 4))
plot(c(-0.15, 1.3), 0:1, type = "n", axes = FALSE)

text(0.6, 0.9, "Variables")
rect(0.4, 0.8, 0.8, 1)

text(0.25, 0.5, "Num√©ricas")
rect(0.1, 0.4, 0.4, 0.6)
arrows(0.45, 0.78, 0.34, 0.62, length = 0.08)

text(0.9, 0.5, "Categ√≥ricas")
rect(0.73, 0.4, 1.07, 0.6)
arrows(0.76, 0.78, 0.85, 0.62, length = 0.08)

text(0, 0.1, "Discretas")
rect(-0.17, 0, 0.17, 0.2)
arrows(0.13, 0.38, 0.05, 0.22, length = 0.08)

text(0.39, 0.1, "Continuas")
rect(0.25, 0, 0.53, 0.2)
arrows(0.35, 0.38, 0.4, 0.22, length = 0.08)

text(0.77, 0.105, "Ordinales")
rect(0.64, 0, 0.9, 0.2)
arrows(0.82, 0.38, 0.77, 0.22, length = 0.08)

text(1.12, 0.1, "Nominales")
rect(0.99, 0, 1.25, 0.2)
arrows(1.02, 0.38, 1.1, 0.22, length = 0.08)
par(par_og) # restore original par
```
   
   
## Variables num√©ricas

```{r}
#| echo: false
#| fig-align: center

par_og <- par(no.readonly = TRUE) # Save original par
par(mar = rep(0, 4))
plot(c(-0.15, 1.3), 0:1, type = "n", axes = FALSE)

# Main category
text(0.6, 0.9, "Variables")
rect(0.4, 0.8, 0.8, 1)

# Numerical section (bold)
text(0.25, 0.5, "Num√©ricas")
rect(0.1, 0.4, 0.4, 0.6)
arrows(0.45, 0.78, 0.34, 0.62, length = 0.08)

text(0, 0.1, "Discretas")
rect(-0.17, 0, 0.17, 0.2)
arrows(0.13, 0.38, 0.05, 0.22, length = 0.08)

text(0.39, 0.1, "Continuas")
rect(0.25, 0, 0.53, 0.2)
arrows(0.35, 0.38, 0.4, 0.22, length = 0.08)

# Categorical section (grayed out)
text(0.9, 0.5, "Categ√≥ricas", col = "gray50")
rect(0.73, 0.4, 1.07, 0.6, border = "gray50")
arrows(0.76, 0.78, 0.85, 0.62, length = 0.08, col = "gray50")

text(0.77, 0.105, "Ordinales", col = "gray70")
rect(0.64, 0, 0.9, 0.2, border = "gray70")
arrows(0.82, 0.38, 0.77, 0.22, length = 0.08, col = "gray70")

text(1.12, 0.1, "Nominales", col = "gray70")
rect(0.99, 0, 1.25, 0.2, border = "gray70")
arrows(1.02, 0.38, 1.1, 0.22, length = 0.08, col = "gray70")

par(par_og) # Restore original par

```

## Variables num√©ricas {.medium}

Una variable es [num√©rica]{.hl .hl-blue} cuando puede tomar una amplia gama de valores num√©ricos y tiene sentido realizar operaciones aritm√©ticas (suma, resta, promedio) con esos valores. De lo contrario, es [categ√≥rica]{.hl .hl-blue}.

. . .

Pueden ser:

  - [Discretas]{.hl .hl-blue} si sus posibles valores forman un conjunto de valores separados, como 0, 1, 2, 3...
  
  - [Continuas]{.hl .hl-blue} si sus posibles valores forman un intervalo
   
## Tipos de variables {.medium}

```{r}
#| echo: false

email50 |> 
  select(spam, num_char, line_breaks, format, number) |>
  mutate(spam =ifelse(spam==1, "yes", "no" ),
         format = ifelse(format==1, "html", "text")) |>
  head(10)
```



::: {.incremental}

- spam $\rightarrow$ [categ√≥rica]{.marker-hl}

- num_char $\rightarrow$ [num√©rica]{.marker-hl}

- line_breaks $\rightarrow$ [num√©rica]{.marker-hl}

- format $\rightarrow$ [categ√≥rica]{.marker-hl}

- number $\rightarrow$ [categ√≥rica]{.marker-hl}
:::


# El Histograma {#histograma}

## ¬øC√≥mo hacer un histograma? {.medium}

Paso 1: Dividir el rango de los valores en intervalos

. . .

Paso 2: Contar el n√∫mero de observaciones en cada intervalo

. . .

<br>

::: {.tbl-classic .tbl-larger .center-text}


```{r}
#| eval: true
#| echo: false
library(gapminder)
gapminder |>
  mutate(lifeExp_cat = cut(lifeExp, breaks = seq(20, 90, 10))) |>
  count(lifeExp_cat, name = "Frequency") |>
  separate(lifeExp_cat, into = c("lower", "upper"), sep = ",") |>
  mutate(
    lower = str_remove(lower, "\\("),
    upper = str_remove(upper, "]"),
    lower = str_c("(", lower),
    upper = str_c(upper, "]")
  ) |>
  unite("Life Expectancy", lower:upper, sep = " - ") |>
  kbl(linesep = "", booktabs = TRUE, align = "lr") |>
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    latex_options = c("striped"),
    full_width = FALSE
  ) |>
  column_spec(1:2, width = "9em")
```

:::

## ¬øC√≥mo hacer un histograma? {.medium}

Paso 3: Dibujar el histograma
  
  - No debe haber espacio entre las barras
  
  - Nombrar el eje horizontal (con unidades!)
  
```{r}
#| echo: false
#| fig-align: center
#| fig-width: 5
#| fig-height: 5
ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram(breaks = seq(20, 90, 10), fill="lightblue", color="darkblue") +
  labs(x = "Life Expectancy (years)", y = "Frequency") +
  scale_x_continuous(
    breaks = seq(20, 90, 10)
    ) + theme_minimal()
```


## Histogramas {.medium}

- Los histogramas proporcionan una visi√≥n de la [densidad de los datos]{.hl .hl-blue}. Barras m√°s altas indican regiones con m√°s observaciones.

. . .

- Los histogramas son especialmente √∫tiles para describir la [forma]{.hl .hl-blue} de la distribuci√≥n de los datos.

. . .

- La selecci√≥n del [ancho de las barras]{.hl .hl-blue} puede alterar la forma del histograma.


## El histograma en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "1|2"
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp))
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp))
```
::::

:::::


## El histograma en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2,3,4|5,6|7"
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue")+
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue")+
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()
```
::::

:::::


## El histograma en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "5"
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue",
                 bins = 10)+
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue",
                 bins = 10)+
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()
```
::::

:::::


## El histograma en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "5"
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue",
                 bins = 20)+
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue",
                 bins = 20)+
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()
```
::::

:::::


## Prueben diferentes anchos de barras (# bins) {.medium}

¬øQu√© histograma revela mucho sobres los datos?¬øCu√°l muy poco?

```{r}
#| echo: false
#| layout-ncol: 2
#| fig-align: center
#| fig-width: 4
#| fig-height: 2.5

ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram(bins=5, fill="lightblue", color="darkblue") +
  labs(x = "Life Expectancy (years)", y = "Frequency") + 
  theme_minimal()

ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram(bins=10, fill="lightblue", color="darkblue") +
  labs(x = "Life Expectancy (years)", y = "Frequency") + 
  theme_minimal()

ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram(bins=20, fill="lightblue", color="darkblue") +
  labs(x = "Life Expectancy (years)", y = "Frequency") + 
  theme_minimal()

ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram(bins=30, fill="lightblue", color="darkblue") +
  labs(x = "Life Expectancy (years)", y = "Frequency") + 
  theme_minimal()
```

## Selecci√≥n del ancho de barras (# bins) {.medium}

Es un proceso iterativo: prueba con diferentes n√∫meros.

. . .

¬øQu√© ancho de banda deber√≠an usar?

  - No tan pocos como para que la mayor√≠a de las barras tengan 0 o 1 observaciones.

  - No tantos como para perder los detalles dentro de un barra.
  
  - No hay un n√∫mero de barras ‚Äúperfecto‚Äù y √∫nico.
  
. . .

Regla general: [cuantas m√°s observaciones haya, m√°s barras se deben usar]{.hl .hl-dred}


## El gr√°fico de densidad  {.medium}

El gr√°fico de densidad es una versi√≥n suavizada del histograma. La forma, la escala y la dispersi√≥n de las observaciones son similares que en el histograma. 

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_density(aes(x=lifeExp))
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp))
```
::::

:::::


## La gr√°fica de densidad en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|1,2"
ggplot(gapminder) +
  geom_density(aes(x=lifeExp))
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_density(aes(x=lifeExp))
```
::::

:::::


## La gr√°fica de densidad en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2,3,4|5,6"
ggplot(gapminder) +
  geom_density(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue")+
  labs(y = "Density",
       x = "Life Expectancy (years)") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_density(aes(x=lifeExp),
                 fill = "lightblue",
                 color = "darkblue")+
  labs(y = "Density",
       x = "Life Expectancy (years)") +
  theme_minimal()
```
::::

:::::

## ¬øQu√© mirar en un histograma? {.medium}

[Centro]{.marker-hl}

‚Ä¢ ¬øD√≥nde est√° el "medio" del histograma?

‚Ä¢ Se representa usualmente con la [media]{.hl .hl-blue} y la [mediana]{.hl .hl-blue}.

. . . 

<br>

[Dispersi√≥n]{.marker-hl}

‚Ä¢ ¬øCu√°l es el rango de los datos?

‚Ä¢ Se representa usualmente con la [desviaci√≥n est√°ndar]{.hl .hl-blue} y el [rango intercuart√≠lico]{.hl .hl-blue} (se explicar√° pronto).


## ¬øQu√© mirar en un histograma? {.medium}

[Forma]{.marker-hl}

‚Ä¢ Sim√©trica o sesgada (asim√©trica).

‚Ä¢ N√∫mero de modas (picos).

. . .

<br>

[Valores at√≠picos (Outliers)]{.marker-hl}

‚Ä¢ ¬øHay observaciones que est√°n fuera del patr√≥n general?

‚Ä¢ Pueden ser valores inusuales o errores. ¬°Rev√≠senlos!




## Asimetr√≠a en los Histogramas {.medium}

El [sesgo]{.marker-hl} mide qu√© tan asim√©tricos est√°n distribuidos los datos

### distribuci√≥n sesgada a la izquierda (-), sim√©trica y sesgada a la derecha (+)


```{r}
#| echo: false
#| fig-align: center
#| fig-width: 10

p1 <- ggplot(gapminder) +
  geom_histogram(aes(x=log(lifeExp)), bins = 10 , fill="lightblue", color="darkblue")+
  labs(y = "",
       x = "") +
  theme_minimal() +
  theme(axis.text = element_blank())  # Remove axis numbers


p2 <- ggplot(gapminder) +
  geom_histogram(aes(x=log(pop)), bins = 10 , fill="lightblue", color="darkblue")+
  labs(y = "",
       x = "") +
  theme_minimal() +
  theme(axis.text = element_blank())  # Remove axis numbers

p3 <- ggplot(gapminder) +
  geom_histogram(aes(x=gdpPercap), bins = 10 , fill="lightblue", color="darkblue")+
  labs(y = "",
       x = "") +
  theme_minimal() +
  theme(axis.text = element_blank())  # Remove axis numbers

p1+p2+p3

```


## Moda en los Histogramas {.medium}

La [moda]{.marker-hl} es el dato que m√°s se repite en la distribuci√≥n

### Un ejemplo de distribuci√≥n unimodal, bimodal y multimodal 

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 10
df_modes <- tibble(
  uni   = rchisq(65, 6),
  bi    = c(rchisq(25, 5.8), rnorm(40, 20, 2)),
  multi =  c(rchisq(25, 3), rnorm(25, 15), rnorm(15, 25, 1.5))
)

p_uni <- ggplot(df_modes, aes(x = uni)) +
  geom_histogram(binwidth = 2, fill="lightblue", color="darkblue") +
  labs(x = NULL, y = NULL) +
  ylim(0, 23) +
  xlim(0, 30) + theme_minimal()
p_bi <- ggplot(df_modes, aes(x = bi)) +
  geom_histogram(binwidth = 2, fill="lightblue", color="darkblue") +
  labs(x = NULL, y = NULL) +
  ylim(0, 23) +
  xlim(0, 30) + theme_minimal()
p_multi <- ggplot(df_modes, aes(x = multi)) +
  geom_histogram(binwidth = 2, fill="lightblue", color="darkblue") +
  labs(x = NULL, y = NULL) +
  ylim(0, 23) +
  xlim(0, 30) + theme_minimal()

p_uni + p_bi + p_multi
```


## Ejemplo con la Expectativa de vida {.medium}

```{r}
#| echo: false
#| fig-width: 10
#| fig-align: center

ggplot(gapminder, aes(x = lifeExp)) +
  geom_histogram(bins=20, fill="lightblue", color="darkblue") +
  labs(x = "Life Expectancy (years)", y = "Frequency") + 
  theme_minimal()

```

. . .

Adicional al pico cerca a los 70 a√±os, pareciera existir otro pico a los 40-45 a√±os.


## La expectativa de vida es... {.medium}

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp), bins = 20, fill="lightblue", color="darkblue") +
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal() +
  facet_wrap(~continent, ncol = 1)
```

::: {.absolute top="10%" right="-15%" width="340px" .textbox .fragment .fade-up style="font-size:1.7rem;padding:0.5rem 1rem;" .altlist}
Mucho m√°s baja y con alta variaci√≥n en √Åfrica
:::

::: {.absolute bottom="10%" left="-10%" width="340px" .textbox .fragment .fade-up style="font-size:1.7rem;padding:0.5rem 1rem;" .altlist}
Uniforme y alta en Europa y Ocean√≠a
:::


## üí™ Ejercicio 2  {.medium}

1. Dibujen un histograma para la variable `price`. ¬øExiste sesgo?

2. Intenten el punto anterior para distinto n√∫mero de *bins*.

3. Por la dificultad de graficar el anterior histograma, censuremos un poco los datos con el siguiente c√≥digo:

```{r}
#| echo: true
#| eval: false
newdata <- airbnb |>
  filter(price<3*sd(price, na.rm = TRUE))
```

4. Intenten graficar el histograma nuevamente y elijan el n√∫mero de *bins* que para ustedes provea m√°s informaci√≥n.


# Medidas de tendencia central {#central}

## La media {.medium}
Es la suma de todos los valores dividida entre el n√∫mero de valores observados:

$$\bar{x} = \dfrac{x_1+x_2+...+x_n}{n}$$

. . .

**Ejemplo.** Supongamos que tenemos los siguientes valores:

$$4, 8, 3, 5, 13$$
La media de la variable ser√°:

$$\bar{x} = \dfrac{4+8+3+5+13}{5}=\dfrac{33}{5}=6.6$$

## La mediana {.medium}

Es el valor que denota el punto medio en una distribuci√≥n ordenada. En otras palabras, 50% de los valores est√°n por debajo de este valor.


**Ejemplo 1** Supongamos que tenemos los siguientes valores: 4, 8, 3, 5, 13.

$$\begin{align*}
\text{datos} &\to 4 \quad 8\quad 3\quad 5\quad 13 \\
\text{organizados} &\to 3 \quad 4\quad {\color{orange} 5}\quad 8\quad 13 \\
\end{align*}$$

La mediana es 5.

## La mediana {.medium}

Es el valor que denota el punto medio en una distribuci√≥n ordenada. En otras palabras, 50% de los valores est√°n por debajo de este valor.


**Ejemplo 2** Supongamos que tenemos los siguientes valores: 4, 8, 3, 5, 13, 12..

$$
\begin{align*}
\text{datos} &\to 4\quad 8\quad 3\quad 5\quad 13\quad 12 \\
\text{organizados} &\to 3\quad 4 \quad {\color{orange} 5}\quad {\color{orange} 8}\quad 12\quad 13 \\
\end{align*}
$$

La mediana es $\frac{5 + 8}{2} = 6,5$.


## Tendencia central y sesgo {.medium}

La asimetr√≠a de una distribuci√≥n est√° relacionada a la ubicaci√≥n de las medidas de tendencia central dentro de la misma distribuci√≥n.


::: columns
::: {.column width="33.3%"}
![](img/bias1.png){.absolute width=30% height=40%}
:::

::: {.column width="33.3%"}
![](img/bias2.png){.absolute width=30% height=40%}
:::

::: {.column width="33.3%"}
![](img/bias3.png){.absolute width=30% height=40%}
:::
:::


## Media vs Mediana {.medium}


```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7
mean_median_values <- gapminder |>
  group_by(continent) |>
  summarize(
    mean_lifeExp = mean(lifeExp, na.rm = TRUE),
    median_lifeExp = median(lifeExp, na.rm = TRUE)
  )

# Create the plot
ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp), bins = 20, fill="lightblue", color="darkblue") +
  labs(y = "Frequency", x = "Life Expectancy (years)") +
  theme_minimal() +
  facet_wrap(~continent, ncol = 1) +
  geom_vline(data = mean_median_values, aes(xintercept = mean_lifeExp, color = "Mean"),
             linetype = "dashed", size = 1) +
  geom_vline(data = mean_median_values, aes(xintercept = median_lifeExp, color = "Median"),
             linetype = "dashed", size = 1) +
  scale_color_manual(values = c("Mean" = "darkred", "Median" = "darkgreen")) +
  guides(color = guide_legend(title = NULL)) +  # Remove the legend title
  theme(legend.position = "top")
```

::: {.absolute top="10%" left="-10%" width="380px" .textbox .fragment .fade-up style="font-size:1.7rem;padding:0.5rem 1rem;" .altlist}
¬øCu√°l distribuci√≥n es sim√©trica?
:::

::: {.absolute top="10%" right="-10%" width="380px" .textbox .fragment .fade-up style="font-size:1.7rem;padding:0.5rem 1rem;" .altlist}
¬øCu√°l distribuci√≥n es sesgada?
:::

## La media y la mediana en R {.medium}

La media se calcula con la funci√≥n `mean()`:

```{r}
#| echo: true
mean(gapminder$lifeExp)
```

. . . 

La mediana se calcula con la funci√≥n `median()`:

```{r}
#| echo: true
median(gapminder$lifeExp)
```
. . . 

Comparemos para cada continente:

```{r}
#| echo: true
gapminder |>
  group_by(continent) |>
   summarise(mean_lexp = mean(lifeExp),
             median_lexp = median(lifeExp))
```


## üí™ Ejercicio 3  {.medium}

1. Calculen la media y la mediana para cada `neighbourhood_group`.

2. Basado en el punto anterior, ¬øqu√© tipo de sesgo tiene cada barrio?


# Resumen de los Cinco N√∫meros

## Cuartiles y Resumen de Cinco N√∫meros {.medium}

- Los cuartiles dividen los datos en 4 partes iguales.  
    - [Primer cuartil ($Q_1$)]{.hl .hl-blue} = percentil 25:  
       El 25% de los datos est√°n por debajo y el 75% por encima.
       
    - [Segundo cuartil ($Q_2$)]{.hl .hl-blue} = mediana = percentil 50  
    
    - [Tercer cuartil ($Q_3$)]{.hl .hl-blue} = percentil 75:  
       El 75% de los datos est√°n por debajo y el 25% por encima. 
       
. . .
       
- [Rango intercuart√≠lico (RIC)]{.hl .hl-blue} = $Q_3 ‚àí Q_1$  

. . .
  
- [Resumen de cinco n√∫meros]{.hl .hl-blue}: 

  $$ min \quad Q_1 \quad mediana \quad Q3 \quad max  $$

## Cuartiles {.medium}

Se calculan de acuerdo a la posici√≥n en los datos ordenados:

$$Q_1 : \dfrac{n+1}{4}$$
$$Q_2 : \dfrac{n+1}{2}$$

$$Q_3 : \dfrac{3(n+1)}{4}$$

Donde $n$ es el n√∫mero de valores.


## Cuartiles {.medium}

$$X=11, 12, 13, 16, 16, 17, 18, 21, 22$$

- $Q_1$ est√° en la posici√≥n $\dfrac{(9+1)}{4}=2.5$

- Calculamos el promedio de los valores en la posici√≥n 2 y 3.

$$Q_1=\dfrac{12+13}{2}=12.5$$

## Cuartiles {.medium}

$$X=11, 12, 13, 16, 16, 17, 18, 21, 22$$

- $Q_2: \dfrac{(9+1)}{2}=5$ posici√≥n
$$Q_2=mediana=16$$

- $Q_3: \dfrac{3*(9+1)}{4}=7.5$ posici√≥n

$$Q_3=\dfrac{18+21}{2}=19.5$$

## Resumen de los cinco n√∫meros {.medium}

$$X=11, 12, 13, 16, 16, 17, 18, 21, 22$$

- Min: 11

- $Q_1$: 12.5

- Mediana: 16

- $Q_3$: 19.5

- Max: 22

. . .

### RIC

- $Q_3 ‚àí Q_1$: 19.5 - 12.5 = 7 

## C√°lculo de los cuartiles {.medium}

De hecho, no existe un consenso sobre el c√°lculo de los cuartiles. Hay varias f√≥rmulas para los cuartiles, que var√≠an de un libro a otro y de un software a otro.

. . .

Retomemos el ejemplo de la diapositiva anterior, donde $Q_1$ = 12.5, $Q_2$ = 16 y $Q_3$ = 19.5


```{r}
#| echo: true
 x = c(11,12,13,16,16,17,18,21,22)
summary(x)
fivenum(x)
```


## C√°lculo de los cuartiles {.medium}

Incluso diferentes comandos en <i class="fa-brands fa-r-project"></i> a veces reportan diferente cuartiles:


```{r}
#| echo: true
y = c(43,35,43,33,38,53,64,27,34,27)
summary(y)
fivenum(y)
```

. . .

<br>
No se preocupen por la f√≥rmula. Simplemente tengan en cuenta que:

<center>
[Los cuartiles dividen los datos en 4 partes iguales]{.hl .hl-dred}
<center>


# Diagrama de caja {#boxplot}

## El diagrama de caja {.medium}

El diagrama de caja es la manera m√°s com√∫n de visualizar los 5 estad√≠sticos que explicamos anteriormente. Al mismo tiempo, un diagrama de caja identifica observaciones *inusuales*.

<br>

![](img/boxplot.png){fig-align="center" width=800 height=200}



## El diagrama de caja - RIC {.medium}

<br>

![](img/ric.png){fig-align="center" width=800 height=360}

. . .


El [RIC]{.hl .hl-blue} es una medida de la variabilidad de los datos. El RIC tiende a ser mayor si la variaci√≥n de los datos tambi√©n es mayor.


## Diagrama de caja - Outliers {.medium}

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 9
ggplot(gapminder) +
  geom_boxplot(aes(x=lifeExp, y=continent)) +
   labs(y = "Continent",
       x = "Life Expectancy (years)") +
  theme_minimal()
```

Una observaci√≥n se identifica como un posible valor at√≠pico (*outlier*) si se encuentra m√°s de 1.5 √ó RIC por debajo de $Q_1$ o por encima de $Q_3$

## Diagrama de caja vs Histograma {.medium}

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 10
p1 <- ggplot(gapminder) +
  geom_boxplot(aes(x=lifeExp)) +
  labs(x = "Life Expectancy (years)") +
  theme_minimal()

p2 <- ggplot(gapminder) +
  geom_histogram(aes(x=lifeExp), bins = 10,
                 fill = "lightblue", color = "darkblue") + 
  labs(y = "Frequency",
       x = "Life Expectancy (years)") +
  theme_minimal()

p1 + p2
```


## El diagrama de caja en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|1,2,3,4"
ggplot(gapminder) +
  geom_boxplot(aes(x=lifeExp)) +
  labs(x = "Life Expectancy (years)") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_boxplot(aes(x=lifeExp)) + 
  labs(x = "Life Expectancy (years)") +
  theme_minimal()
```
::::

:::::


## El diagrama de caja en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|3"
ggplot(gapminder) +
  geom_boxplot(aes(y=lifeExp)) +
  labs(y = "Life Expectancy (years)") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_boxplot(aes(y=lifeExp)) +
  labs(y = "Life Expectancy (years)") +
  theme_minimal()
```
::::

:::::


## El diagrama de caja en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|1,2,3,4,5"
ggplot(gapminder) +
  geom_boxplot(aes(x=lifeExp , y=continent)) +
  labs(x = "Life Expectancy (years)",
       y = "Continent") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder) +
  geom_boxplot(aes(x=lifeExp, y=continent)) + 
  labs(x = "Life Expectancy (years)",
       y = "Continent") +
  theme_minimal()
```
::::

:::::


## üí™ Ejercicio 4  {.medium}

1. Grafiquen los diagramas de caja para cada `neighbourhood_group`.

2. Describan con 3 aspectos las 5 gr√°ficas. Dos ejemplos: todos los barrios tienen una presencia fuerte de outliers y Manhattan tiene la mediana mayor.

3. Usando la funci√≥n `IQR()`, calculen el rango intercuart√≠lico para cada barrio.

4. ¬øQu√© pueden decir a partir del punto anterior?


# Medidas de dispersi√≥n {#dispersion}

## El Rango {.medium}


Es la distancia cubierta por los valores en una distribuci√≥n, es decir, la distancia entre menor y el mayor valor

Se calcula de la siguiente manera:
$$Rango=X_{max}-X_{min}$$

Usualmente es m√°s √∫til reportar el m√≠nimo y el m√°ximo que reportar el rango

## La desviaci√≥n est√°ndar {.medium}

Describe la forma en que los valores de una variable se dispersan a lo largo de la distribuci√≥n en relaci√≥n a la media.

Se calcula siguiendo la f√≥rmula:
$$s_x=\sqrt{\dfrac{\sum{(x-\bar{x})^2}}{n-1}} $$

## La desviaci√≥n est√°ndar {.medium}

Tomemos el siguiente conjunto de datos como ejemplo:

$$x = 1, 9 , 5, 8, 7$$

La media es $\bar{x}=6$. 

. . .

La [desviaci√≥n]{.marker-hl} es la distancia de un valor a la media. El siguiente paso es calcular la desviaci√≥n de cada valor:

$$
\begin{aligned}
1 - \bar{x} &= 7 - 6 = -5 \\
9 - \bar{x} &= 9 - 6 = 3 \\
&\vdots \\
7 - \bar{x} &= 7 - 6 = 1  \\
\end{aligned}
$$

## La desviaci√≥n est√°ndar {.medium}

Si calculamos el cuadrado de estas desviaciones y luego calculamos su promedio hallaremos la [varianza muestral]{.marker-hl}:

$$s^2=\dfrac{(-5)^2+(3)^2+(-1)^2+(2)^2+(1)^2}{5-1}=10$$

. . .

Dividimos por $n-1$ para que la varianza muestral sea m√°s confiable y √∫til, seg√∫n ciertas propiedades estad√≠sticas.

. . . 

La desviaci√≥n est√°ndar se define como la ra√≠z cuadrada de la varianza:

$$s_x=\sqrt{10}=3.16$$

## Algunas caracter√≠sticas de la desviaci√≥n est√°ndar {.medium}

- Sumar la misma constante a cada valor, NO modifica la desviaci√≥n est√°ndar

- Multiplicar cada valor por la misma constante, aumenta la desviaci√≥n est√°ndar en la misma proporci√≥n

- A diferencia de la varianza, la desviaci√≥n est√°ndar est√° en las mismas unidades que la variable original

## La desviaci√≥n est√°ndar vs la distribuci√≥n de los datos {.medium}

<div style="margin-top: 50px;"></div>


::: columns
::: {.column width="33.3%"}
```{r}
#| echo: false
#| fig.align: 'center'
numbersA <- c(11,12,13,16,16,17,18,21)
# Generate the histogram
hist(numbersA, breaks = c(10:22),
     main = "Datos A = 11,12,13,16,16,17,18,21", xlab = "X", ylab = "",
     col = "#ebc034", border = "black", ylim = c(0, 3),
     cex.main = 2.5,  # Increase title size (default is 1)
     cex.axis = 1.8,  # Increase axis numbers size
     cex.lab = 2.2)   # Increase axis label size (default is 1)
abline(v = 15.5, col = "purple", lty = 2, lwd = 2) # lty=2 for dashed line, lwd=2 for line width


```

:::

::: {.column width="33.3%"}
```{r}
#| echo: false
#| fig.align: 'center'
numbersB <- c(14,15,15,15,16,16,16,17)
# Generate the histogram
hist(numbersB, breaks = c(10:22),
     main = "Datos B = 14,15,15,15,16,16,16,17", xlab = "X", ylab = "",
     col = "#3489eb", border = "black", ylim = c(0, 3),
     cex.main = 2.5,  # Increase title size (default is 1)
     cex.axis = 1.8,  # Increase axis numbers size
     cex.lab = 2.2)   # Increase axis label size (default is 1)
abline(v = 15.5, col = "purple", lty = 2, lwd = 2) # lty=2 for dashed line, lwd=2 for line width

```
:::

::: {.column width="33.3%"}
```{r}
#| echo: false
#| fig.align: 'center'
numbersC <- c(11,11,11,12,19,20,20,20)
# Generate the histogram
hist(numbersC, breaks = c(10:22),
     main = "Datos C = 11,11,11,12,19,20,20,20", xlab = "X", ylab = "",
     col = "#3ba342", border = "black", ylim = c(0, 3),
     cex.main = 2.5,  # Increase title size (default is 1)
     cex.axis = 1.8,  # Increase axis numbers size
     cex.lab = 2.2)   # Increase axis label size (default is 1)
abline(v = 15.5, col = "purple", lty = 2, lwd = 2) # lty=2 for dashed line, lwd=2 for line width

```
:::
:::

- Noten que las 3 muestras tienen la misma media: $\bar{x}=15.5$

- Las desvaciones est√°ndar son <span style="color: #ebc034;">S=3.33</span>, <span style="color: #3489eb;">S=0.92</span> and <span style="color: #3ba342;">S=4.56</span>.


## La regla 68% y 95% {.medium}

- Aproximadamente el 68% de las observaciones estar√°n dentro de 1 desviaci√≥n est√°ndar de la media.

- Aproximadamente el 95% de las observaciones estar√°n dentro de 2 desviaciones est√°ndar de la media.

- Ambas reglas funcionan **muy bien** para datos con forma de campana y **razonablemente bien** para datos unimodales y no muy sesgados, pero no para todos los datos.

## La regla 68% y 95% {.medium}

::: columns
::: {.column width="60%"}

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7

# Compute mean and standard deviation for each continent
mean_median_values <- gapminder |>
  group_by(continent) |>
  summarise(
    mean_lifeExp = mean(lifeExp),
    sd_lifeExp = sd(lifeExp)
  )

# Create a dataset for the polygons (¬±1 SD around the mean)
polygon_data <- mean_median_values |>
  mutate(
    x_min = mean_lifeExp - sd_lifeExp,
    x_max = mean_lifeExp + sd_lifeExp,
    y_min = 0,
    y_max = 100  # Adjust based on the histogram's scale
  )

# Plot histogram with polygon and mean line
ggplot(gapminder) +
  geom_histogram(aes(x = lifeExp), bins = 20, fill = "lightblue", color = "darkblue") +
  geom_rect(
    data = polygon_data,
    aes(xmin = x_min, xmax = x_max, ymin = y_min, ymax = y_max, fill = continent),
    alpha = 0.2
  ) +
  geom_vline(
    data = mean_median_values, 
    aes(xintercept = mean_lifeExp, color = "Mean"),
    linetype = "dashed", size = 1
  ) +
  scale_fill_manual(values = c("Africa" = "red", "Americas" = "red", 
                               "Asia" = "red", "Europe" = "red", "Oceania" = "red")) +
  scale_color_manual(values = c("Mean" = "darkred")) +
  labs(y = "Frequency", x = "Life Expectancy (years)") +
  theme_minimal() +
  facet_wrap(~continent, ncol = 1) +
  guides(fill = "none", color = guide_legend(title = NULL)) +  # Remove legend title
  theme(legend.position = "none")  # Removes all legends

```

:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7

# Unir la informaci√≥n de la media y la desviaci√≥n est√°ndar con el dataset original
gapminder_with_stats <- gapminder |>
  left_join(mean_median_values, by = "continent") |>
  mutate(
    within_1SD = lifeExp >= (mean_lifeExp - sd_lifeExp) & lifeExp <= (mean_lifeExp + sd_lifeExp)
  )

# Calcular la proporci√≥n de observaciones dentro de 1 SD por continente
proportion_1SD <- gapminder_with_stats |>
  group_by(continent) |>
  summarise(proportion_1SD = mean(within_1SD))

proportion_1SD
```
:::
:::



## La regla 68% y 95% {.medium}

::: columns
::: {.column width="60%"}

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7


# Create a dataset for the polygons (¬±1 SD around the mean)
polygon_data <- mean_median_values |>
  mutate(
    x_min = mean_lifeExp - 2*sd_lifeExp,
    x_max = mean_lifeExp + 2*sd_lifeExp,
    y_min = 0,
    y_max = 100  # Adjust based on the histogram's scale
  )

# Plot histogram with polygon and mean line
ggplot(gapminder) +
  geom_histogram(aes(x = lifeExp), bins = 20, fill = "lightblue", color = "darkblue") +
  geom_rect(
    data = polygon_data,
    aes(xmin = x_min, xmax = x_max, ymin = y_min, ymax = y_max, fill = continent),
    alpha = 0.2
  ) +
  geom_vline(
    data = mean_median_values, 
    aes(xintercept = mean_lifeExp, color = "Mean"),
    linetype = "dashed", size = 1
  ) +
  scale_fill_manual(values = c("Africa" = "red", "Americas" = "red", 
                               "Asia" = "red", "Europe" = "red", "Oceania" = "red")) +
  scale_color_manual(values = c("Mean" = "darkred")) +
  labs(y = "Frequency", x = "Life Expectancy (years)") +
  theme_minimal() +
  facet_wrap(~continent, ncol = 1) +
  guides(fill = "none", color = guide_legend(title = NULL)) +  # Remove legend title
  theme(legend.position = "none")  # Removes all legends

```

:::

::: {.column width="40%"}
```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7

# Unir la informaci√≥n de la media y la desviaci√≥n est√°ndar con el dataset original
gapminder_with_stats <- gapminder_with_stats |>
  mutate(
    within_2SD = lifeExp >= (mean_lifeExp - 2*sd_lifeExp) & lifeExp <= (mean_lifeExp + 2*sd_lifeExp)
  )

# Calcular la proporci√≥n de observaciones dentro de 1 SD por continente
proportion_2SD <- gapminder_with_stats |>
  group_by(continent) |>
  summarise(proportion_2SD = mean(within_2SD))

proportion_2SD
```
:::
:::


## La desviaci√≥n est√°ndar en R {.medium}

La desviaci√≥n est√°ndar se calcula con la funci√≥n `sd`: 

::: columns
::: {.column width="40%"}

```{r}
#| echo: true
gapminder |>
  group_by(continent) |>
  summarise(
    mean_lExp = mean(lifeExp),
    sd_lExp = sd(lifeExp)
  )
```

:::

::: {.column width="60%"}

```{r}
#| echo: false
#| fig-align: center
#| fig-width: 7
ggplot(gapminder) +
  geom_histogram(aes(x = lifeExp), bins = 20, fill = "lightblue", color = "darkblue") +
  geom_vline(
    data = mean_median_values, 
    aes(xintercept = mean_lifeExp, color = "Mean"),
    linetype = "dashed", size = 1
  ) +
  scale_color_manual(values = c("Mean" = "darkred")) +
  labs(y = "Frequency", x = "Life Expectancy (years)") +
  theme_minimal() +
  facet_wrap(~continent, ncol = 1) +
  theme(legend.position = "none")  # Removes all legends
```
:::
:::


## üí™ Ejercicio 5  {.medium}

1. Usando la funci√≥n `mutate`, creen una nueva variable llamada `within_1SD` que sea igual a TRUE si el precio se encuentra dentro de una desviaci√≥n est√°ndar de la media, y FALSE en caso contrario. Es decir, la variable debe ser TRUE si el precio est√° en el rango de [media - 1 * desviaci√≥n est√°ndar, media + 1 * desviaci√≥n est√°ndar], y FALSE si no est√° en este rango.

2. Calculen la media de `within_1SD`. Recuerden que el promedio de una variable que toma valores 0 o 1 corresponde a la proporci√≥n de observaciones que cumplen la condici√≥n. ¬øLa proporci√≥n obtenida se aproxima al 68%?



# Medidas de relaci√≥n entre dos variables {#bivariado}

## Diagramas de dispersi√≥n {.medium}

::: columns
::: {.column width="50%"}
```{r}
#| echo: false
#| fig.align: 'center'
ggplot(gapminder)+
  geom_point(aes(x=log(gdpPercap), y=lifeExp)) + 
  labs(x = "log(GDP per c√°pita)",
       y = "Life Expectancy") +
  theme_minimal()
```
:::

::: {.column width="50%"}
- Los gr√°ficos de dispersi√≥n nos ayudan a visualizar y examinar la relaci√≥n entre dos variables num√©ricas 
- Discutiremos dos medidas cuantitativas de esta relaci√≥n:
    1. la covarianza
    2. la correlaci√≥n
:::
:::

## El gr√°fico de dispersi√≥n en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|1,2,3,4,5"
ggplot(gapminder)+
  geom_point(aes(x=gdpPercap, y=lifeExp)) + 
  labs(x = "GDP per c√°pita",
       y = "Life Expectancy") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder)+
  geom_point(aes(x=gdpPercap, y=lifeExp)) + 
  labs(x = "log(GDP per c√°pita)",
       y = "Life Expectancy") +
  theme_minimal()
```
::::

::::


## El gr√°fico de dispersi√≥n en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|1,2,3,4,5"
ggplot(gapminder)+
  geom_point(aes(x=log(gdpPercap), y=lifeExp)) + 
  labs(x = "log(GDP per c√°pita)",
       y = "Life Expectancy") +
  theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder)+
  geom_point(aes(x=log(gdpPercap), y=lifeExp)) + 
  labs(x = "log(GDP per c√°pita)",
       y = "Life Expectancy") +
  theme_minimal()
```
::::

::::


## El gr√°fico de dispersi√≥n en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "2|5"
ggplot(gapminder)+
    geom_point(aes(x=log(gdpPercap), y=lifeExp, color = continent)) + 
    labs(x = "log(GDP per c√°pita)",
         y = "Life Expectancy") +
    scale_color_brewer(name = "Continent", palette = "Dark2") +
    theme_minimal()
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder)+
    geom_point(aes(x=log(gdpPercap), y=lifeExp, color = continent)) + 
    labs(x = "log(GDP per c√°pita)",
         y = "Life Expectancy") +
    scale_color_brewer(name = "Continent", palette = "Dark2") +
    theme_minimal()
```
::::

::::


## El gr√°fico de dispersi√≥n en R {.medium}

::::: {.columns}

:::: {.column width="50%"}
```{r}
#| echo: true
#| eval: false
#| code-line-numbers: "7|1,2,3,4,5,6,7"
ggplot(gapminder)+
    geom_point(aes(x=log(gdpPercap), y=lifeExp, color = continent)) + 
    labs(x = "log(GDP per c√°pita)",
         y = "Life Expectancy") +
    scale_color_brewer(name = "Continent", palette = "Dark2") +
    theme_minimal() + 
    facet_wrap(~continent, ncol = 3)
```

::::

:::: {.column  width="50%"}

```{r}
#| echo: false
#| fig-align: center
#| out-width: 100%
ggplot(gapminder)+
    geom_point(aes(x=log(gdpPercap), y=lifeExp, color = continent)) + 
    labs(x = "log(GDP per c√°pita)",
         y = "Life Expectancy") +
    scale_color_brewer(name = "Continent", palette = "Dark2") +
    theme_minimal() + 
    facet_wrap(~continent, ncol = 3)
```
::::

::::

La opci√≥n `facet_wrap()` separa el gr√°fico por grupos. Este [link](https://ggplot2.tidyverse.org/reference/facet_wrap.html) explica c√≥mo usarla y da ejemplos.


## Covarianza {.medium}

- La covarianza mide qu√© tan fuerte es la relaci√≥n (lineal) de *dos variables num√©ricas*.

- La covarianza se calcula de la siguiente manera:

$$cov(X,Y)=\dfrac{\sum_{i=1}^{n}(X_i-\bar{X})(Y_i-\bar{Y})}{n-1}$$

- Solamente mide la "direcci√≥n" de la relaci√≥n.

## Interpretaci√≥n de la covarianza {.medium}

- La covarianza entre dos variables:
  - $cov(X,Y)>0 \rightarrow$ $X$ y $Y$ se mueven en la misma direcci√≥n.
  - $cov(X,Y)<0 \rightarrow$ $X$ y $Y$ se mueven en direcci√≥n opuesta.
  - $cov(X,Y)=0 \rightarrow$ $X$ y $Y$ son independientes.
- El defecto de la covarianza es que no indica la intensidad de la relaci√≥n entre las dos variables

## Correlaci√≥n {.medium}

- La correlaci√≥n mide la direcci√≥n y la fuerza de la relaci√≥n lineal entre dos variables num√©ricas.

$$r=\dfrac{cov(X,Y)}{s_xs_y}$$

## Caracter√≠sticas de la correlaci√≥n {.medium}

- $-1< r < 1$
- $r$ no cambia cuando se cambian las unidades de medida de $X$, $Y$ o ambas.
- $r$ no tiene unidad de medida
- M√°s cerca a -1, m√°s fuerte `la relaci√≥n lineal negativa`.
- M√°s cerca a 1, m√°s fuerte `la relaci√≥n lineal positiva`.
- M√°s cerca a 0, m√°s d√©bil `la relaci√≥n lineal`.


## Valores y gr√°ficos de la correlaci√≥n {.medium}

![](img/correlacion.png){fig-align="center" width=80% height=80%}


## La correlaci√≥n en R {.medium}

La correlaci√≥n se calcula con la funci√≥n `cor`:

::::: {.columns}

:::: {.column width="60%"}
```{r}
#| echo: false
ggplot(gapminder)+
    geom_point(aes(x=log(gdpPercap), y=lifeExp, color = continent)) + 
    labs(x = "log(GDP per c√°pita)",
         y = "Life Expectancy") +
    scale_color_brewer(name = "Continent", palette = "Dark2") +
    theme_minimal()
```

::::

:::: {.column  width="40%"}

```{r}
#| echo: true
gapminder |> 
  group_by(continent) |>
  summarise(
    corr = cor(lifeExp, gdpPercap)
    )
```
::::

::::


## La correlaci√≥n en R {.medium}

En ocasiones es mejor separar los gr√°ficos para cada categor√≠a:

::::: {.columns}

:::: {.column width="60%"}
```{r}
#| echo: false
#| code-line-numbers: "7,8|1,2,3,4,5,6,7,8"
ggplot(gapminder)+
    geom_point(aes(x=log(gdpPercap), y=lifeExp, color = continent)) + 
    labs(x = "log(GDP per c√°pita)",
         y = "Life Expectancy") +
    scale_color_brewer(name = "Continent", palette = "Dark2") +
    theme_minimal() + 
    facet_wrap(~continent, ncol = 3) + 
    theme(legend.position = "none")
```

::::

:::: {.column  width="40%"}

```{r}
#| echo: true
gapminder |> 
  group_by(continent) |>
  summarise(
    corr = cor(lifeExp, gdpPercap)
    )
```
::::

::::


## üí™ Ejercicio 6  {.medium}

1. Grafiquen la dispersi√≥n entre el precio y el n√∫mero de rese√±as (reviews). ¬øQu√© tipo de relaci√≥n visualizan entre estas dos variables?

2. Calculen la correlaci√≥n entre el precio y el n√∫mero de rese√±as. ¬øEl valor obtenido tiene sentido con lo que observan en la gr√°fica del punto anterior?

3. En ocasiones, la relaci√≥n entre dos variables no es clara a primera vista. La funci√≥n `geom_smooth()` facilita visualizar posibles relaciones. Por ejemplo:

```{r}
#| echo: true
#| eval: false
ggplot(newdata) +
  geom_smooth(aes(y=number_of_reviews, x=price))
```

¬øQu√© historia nos cuenta esta nueva gr√°fica? ¬øTiene sentido para ustedes la relaci√≥n observada entre las variables?
